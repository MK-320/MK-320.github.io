import{d as E,h as g,p as f,q as M,ai as G,c,o as s,n as b,G as h,w as y,k as C,b as F,Z as V,F as P,B as q}from"./framework.B1MQ1pB5.js";import{i as K,b as U,d as W,T as z}from"./Tooltip.C3mXnMQV.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang.CARLrAG8.js";import{_ as k}from"./icon.vue_vue_type_script_setup_true_lang.D7tEEnE3.js";import{R as J}from"./RenderVNode.EYv_MnUH.js";var Q="[object AsyncFunction]",X="[object Function]",Y="[object GeneratorFunction]",ee="[object Proxy]";function B(p){if(!K(p))return!1;var u=U(p);return u==X||u==Y||u==Q||u==ee}const le={key:0,class:"vm-select__loading"},te={key:1,class:"vm-select__nodata"},ne={key:2,class:"vm-select__menu"},oe=["id","onClick"],pe=E({name:"VmSelect",inheritAttrs:!1,__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","update:modelValue","visible-change","clear"],setup(p,{emit:u}){const O=l=>{const n=t.options.find(o=>o.value===l);return n||null},$=g(()=>t.remote?300:0),t=p,i=u,m=O(t.modelValue),v=f(),_=f(),r=f(!1),T={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,fn:({state:l})=>{l.styles.popper.width=`${l.rects.reference.width}px`},phase:"beforeWrite",requires:["computeStyles"]}]},a=f(t.options);M(()=>t.options,l=>{a.value=l}),M(()=>t.modelValue,async l=>{const n=O(l);e.inputValue=n?n.label:"",e.selectedOption=n;const o=n?n.value:"";i("change",o),i("update:modelValue",o)});const w=async l=>{if(t.filterable)if(t.filterMethod&&B(t.filterMethod))a.value=t.filterMethod(l);else if(t.remote&&t.remoteMethod&&B(t.remoteMethod)){e.loading=!0;try{a.value=await t.remoteMethod(l)}catch(n){console.error(n),a.value=[]}finally{e.loading=!1}}else a.value=t.options.filter(n=>n.label.includes(l))},D=()=>{w(e.inputValue)},R=W(()=>{D()},$.value),e=G({inputValue:m?m.label:"",selectedOption:m,mouseHover:!1,loading:!1,highlightIndex:-1}),j=g(()=>t.filterable&&e.selectedOption&&r.value?e.selectedOption.label:t.placeholder),d=l=>{l?(t.filterable&&e.inputValue&&(e.inputValue=""),t.filterable&&w(e.inputValue),v.value.show()):(v.value.hide(),t.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:"")),r.value=l,i("visible-change",l)},S=l=>{switch(l.key){case"Enter":r.value?e.highlightIndex>-1&&a.value[e.highlightIndex]?x(a.value[e.highlightIndex]):d(!1):d(!0);break;case"Escape":r.value&&d(!1);break;case"ArrowUp":l.preventDefault(),a.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===0?e.highlightIndex=a.value.length-1:e.highlightIndex--);break;case"ArrowDown":l.preventDefault(),a.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===a.value.length-1?e.highlightIndex=0:e.highlightIndex++);break}},A=g(()=>t.clearable&&e.inputValue.trim()!==""&&e.selectedOption&&e.mouseHover),H=()=>{e.inputValue="",e.selectedOption=null,i("clear"),i("change",""),i("update:modelValue","")},L=()=>{},N=()=>{t.disabled||(r.value?d(!1):d(!0))},x=l=>{l.disabled||(e.inputValue=l.label,e.selectedOption=l,i("change",l.value),i("update:modelValue",l.value),d(!1),_.value.ref.focus())};return(l,n)=>(s(),c("div",{class:b(["vm-select",{"is-disabled":l.disabled}]),onClick:N,onMouseenter:n[2]||(n[2]=o=>e.mouseHover=!0),onMouseleave:n[3]||(n[3]=o=>e.mouseHover=!1)},[h(z,{placement:"bottom-start",manual:"",ref_key:"tooltipRef",ref:v,"popper-options":T,onClickOutside:n[1]||(n[1]=o=>d(!1))},{content:y(()=>[e.loading?(s(),c("div",le,[h(k,{icon:"spinner",spin:""})])):l.filterable&&a.value.length===0?(s(),c("div",te," no matching data ")):(s(),c("ul",ne,[(s(!0),c(P,null,q(a.value,(o,ae)=>{var I;return s(),c("li",{class:b(["vm-select__menu-item",{"is-disabled":o.disabled,"is-selected":((I=e.selectedOption)==null?void 0:I.value)===o.value}]),id:`select-item-${o.value}`,onClick:V(ie=>x(o),["stop"])},[h(C(J),{vNode:l.renderLabel?l.renderLabel(o):o.label},null,8,["vNode"])],10,oe)}),256))]))]),default:y(()=>[h(Z,{modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=o=>e.inputValue=o),disabled:l.disabled,s:"",placeholder:j.value,ref_key:"inputRef",ref:_,readonly:!l.filterable||!r.value,onInput:C(R),onKeydown:S},{suffix:y(()=>[A.value?(s(),F(k,{key:0,icon:"circle-xmark",class:"vm-input__clear",onMousedown:V(L,["prevent"]),onClick:V(H,["stop"])})):(s(),F(k,{key:1,icon:"angle-down",class:b(["header-angsle",{"is-active":r.value}])},null,8,["class"]))]),_:1},8,["modelValue","disabled","placeholder","readonly","onInput"])]),_:1},512)],34))}});export{pe as _};
